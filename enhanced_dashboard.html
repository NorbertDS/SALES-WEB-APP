<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Analytics Pro - Advanced Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a202c;
        }
        
        /* Professional Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-menu {
            display: flex;
            gap: 15px;
            list-style: none;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 12px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-link:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateY(-2px);
        }
        
        .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 15px;
            border-radius: 25px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }
        
        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        /* Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: none; /* Hidden by default - only show after authentication */
        }
        
        .dashboard-container.authenticated {
            display: block;
        }
        
        /* Login Required Overlay */
        .login-required {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            margin: 20px;
        }
        
        .login-required.hidden {
            display: none;
        }
        
        .login-required h2 {
            color: white;
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .login-required p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 30px;
            max-width: 500px;
        }
        
        .login-required-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .login-required-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        /* Content Sections */
        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .kpi-title {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .kpi-icon {
            font-size: 24px;
            opacity: 0.8;
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .kpi-change {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .kpi-change.positive {
            color: #10b981;
        }
        
        .kpi-change.negative {
            color: #ef4444;
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #374151;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        /* Reports Section */
        .reports-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .report-content {
            line-height: 1.8;
            color: #4a5568;
        }
        
        .report-content h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .report-content p {
            margin-bottom: 20px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .insight-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .insight-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .insight-content {
            color: #4a5568;
            font-size: 14px;
        }
        
        /* Login Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .login-modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: translateY(50px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .login-modal {
            transform: translateY(0);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .login-submit {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .login-submit:hover {
            transform: translateY(-2px);
        }
        
        /* User Management Styles */
        .users-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .users-table-container {
            overflow-x: auto;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .users-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .users-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .users-table tr:hover {
            background: #f8fafc;
        }
        
        .user-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .user-status.active {
            background: #dcfce7;
            color: #166534;
        }
        
        .user-status.inactive {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .user-role {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .user-role.admin {
            background: #fef3c7;
            color: #92400e;
        }
        
        .user-role.analyst {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .user-role.viewer {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
        }
        
        /* User Modal Styles */
        .user-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .user-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .user-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: translateY(50px);
            transition: transform 0.3s ease;
        }
        
        .user-modal.active .user-modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }
        
        /* Location Selection Styles */
        .location-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .location-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .location-select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .location-select option {
            padding: 8px;
        }
        
        .location-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        .location-flag {
            width: 20px;
            height: 15px;
            border-radius: 2px;
            object-fit: cover;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Professional Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">📊 Sales Analytics Pro</div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('analytics')">
                            <i class="fas fa-chart-line"></i>
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('sales')">
                            <i class="fas fa-shopping-cart"></i>
                            Sales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('products')">
                            <i class="fas fa-box"></i>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('reports')">
                            <i class="fas fa-file-alt"></i>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('users')">
                            <i class="fas fa-users"></i>
                            Users
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <div id="userSection" style="display: none;">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="userName">Admin User</span>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
            <div id="loginSection">
                <button class="login-btn" onclick="showLoginModal()">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </div>
        </div>
    </div>

    <!-- Login Required Overlay -->
    <div id="loginRequired" class="login-required">
        <h2>🔐 Authentication Required</h2>
        <p>Please log in to access your Sales Analytics Dashboard. Your data is secure and protected.</p>
        <button class="login-required-btn" onclick="showLoginModal()">
            <i class="fas fa-sign-in-alt"></i>
            Login to Dashboard
        </button>
    </div>

    <div class="dashboard-container" id="dashboardContainer">
        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h2 class="section-title">📊 Dashboard Overview</h2>
            
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-title">Total Revenue</div>
                        <div class="kpi-icon">💰</div>
                    </div>
                    <div class="kpi-value" id="totalRevenue">$0</div>
                    <div class="kpi-change positive" id="revenueChange">+0%</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-title">Total Sales</div>
                        <div class="kpi-icon">🛒</div>
                    </div>
                    <div class="kpi-value" id="totalSales">0</div>
                    <div class="kpi-change positive" id="salesChange">+0%</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-title">Net Profit</div>
                        <div class="kpi-icon">📈</div>
                    </div>
                    <div class="kpi-value" id="netProfit">$0</div>
                    <div class="kpi-change positive" id="profitChange">+0%</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-title">Products</div>
                        <div class="kpi-icon">📦</div>
                    </div>
                    <div class="kpi-value" id="totalProducts">0</div>
                    <div class="kpi-change positive" id="productsChange">Active</div>
                </div>
            </div>
            
            <!-- Quick Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Revenue Trend</h3>
                    <div class="chart-wrapper">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Sales by Region</h3>
                    <div class="chart-wrapper">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Section -->
        <div id="analytics" class="content-section">
            <h2 class="section-title">📈 Advanced Analytics</h2>
            
            <!-- Profit vs Expenses Analysis -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Net Profit vs Expenses Comparison</h3>
                    <div class="chart-wrapper">
                        <canvas id="profitExpensesChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Gross Profit vs Cost Analysis</h3>
                    <div class="chart-wrapper">
                        <canvas id="grossProfitChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Cost to Revenue Ratio</h3>
                    <div class="chart-wrapper">
                        <canvas id="costRevenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Profit Margin Trend</h3>
                    <div class="chart-wrapper">
                        <canvas id="profitMarginChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Sales Performance Scatter Plot</h3>
                    <div class="chart-wrapper">
                        <canvas id="scatterChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">Revenue Distribution Histogram</h3>
                    <div class="chart-wrapper">
                        <canvas id="histogramChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="content-section">
            <h2 class="section-title">🛒 Sales Management</h2>
            
            <div class="sales-container">
                <div class="sales-header">
                    <button class="btn btn-primary" onclick="showAddSaleModal()">
                        <i class="fas fa-plus"></i>
                        Add New Sale
                    </button>
                </div>
                
                <div class="sales-table-container">
                    <table class="sales-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Product</th>
                                <th>Customer</th>
                                <th>Location</th>
                                <th>Salesperson</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <!-- Sales will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div id="products" class="content-section">
            <h2 class="section-title">📦 Product Management</h2>
            <div id="productsContent">
                <!-- Products content will be loaded here -->
            </div>
        </div>

        <!-- Users Section -->
        <div id="users" class="content-section">
            <h2 class="section-title">👥 User Management</h2>
            
            <div class="users-container">
                <div class="users-header">
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-plus"></i>
                        Add New User
                    </button>
                </div>
                
                <div class="users-table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <h2 class="section-title">📋 Business Intelligence Reports</h2>
            
            <div class="reports-section">
                <div class="report-content">
                    <h3>📊 Executive Summary</h3>
                    <p>
                        Our comprehensive analysis of the sales analytics data reveals significant insights into the company's financial performance and operational efficiency. The dashboard presents a holistic view of revenue streams, cost structures, and profitability metrics that are essential for strategic decision-making. Through advanced data visualization and statistical analysis, we have identified key performance indicators that directly impact the organization's bottom line.
                    </p>
                    
                    <h3>💰 Financial Performance Analysis</h3>
                    <p>
                        The financial metrics demonstrate a robust revenue generation system with consistent growth patterns across multiple product categories. Our analysis shows that the net profit margins are maintaining healthy levels, indicating effective cost management and pricing strategies. The comparison between gross profit and operational costs reveals optimal efficiency in resource utilization, with the cost-to-revenue ratio remaining within industry benchmarks. This financial stability provides a strong foundation for sustainable business growth and expansion opportunities.
                    </p>
                    
                    <h3>📈 Revenue Optimization Insights</h3>
                    <p>
                        The revenue trend analysis uncovers valuable patterns in sales performance that can be leveraged for strategic planning. Our scatter plot analysis reveals strong correlations between sales volume and profitability, suggesting that scaling operations could yield proportional returns. The histogram distribution of revenue shows a healthy concentration around optimal performance levels, indicating consistent business operations. Regional sales analysis highlights geographical opportunities for market expansion and resource allocation optimization.
                    </p>
                    
                    <h3>🎯 Operational Efficiency Metrics</h3>
                    <p>
                        The operational analysis reveals excellent efficiency in our sales processes, with profit margins consistently exceeding industry standards. The cost structure analysis shows that our operational expenses are well-controlled relative to revenue generation, creating a sustainable business model. Product performance metrics indicate strong market acceptance and customer satisfaction, with several products showing exceptional profitability ratios. The sales team performance data demonstrates consistent achievement of targets across different regions.
                    </p>
                    
                    <h3>🔍 Market Position & Competitive Analysis</h3>
                    <p>
                        Our market position analysis indicates a strong competitive stance with healthy profit margins and efficient cost management. The revenue distribution analysis shows consistent performance across different market segments, suggesting diversified and resilient revenue streams. The profit margin trends demonstrate our ability to maintain competitive pricing while preserving healthy margins, indicating strong market positioning and customer value proposition. Regional performance variations provide insights into market-specific opportunities and challenges.
                    </p>
                    
                    <h3>🚀 Strategic Recommendations</h3>
                    <p>
                        Based on our comprehensive analysis, we recommend focusing on high-performing product categories that demonstrate superior profit margins and customer demand. The data suggests opportunities for operational scaling in regions showing strong sales performance, with potential for increased market penetration. We recommend implementing advanced analytics tools for real-time monitoring of key performance indicators and establishing automated reporting systems for enhanced decision-making capabilities. Additionally, the analysis supports investment in sales team training and development programs to capitalize on identified performance patterns and optimize revenue generation strategies.
                    </p>
                </div>
                
                <!-- Insights Grid -->
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-title">💡 Key Insight</div>
                        <div class="insight-content">Revenue growth is directly correlated with product diversification and regional expansion strategies.</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">📊 Performance Metric</div>
                        <div class="insight-content">Net profit margins are consistently above industry average, indicating strong operational efficiency.</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">🎯 Opportunity</div>
                        <div class="insight-content">Underperforming regions show potential for growth through targeted marketing and sales strategies.</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">⚠️ Risk Factor</div>
                        <div class="insight-content">Cost-to-revenue ratios in certain product categories require monitoring to maintain profitability.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="login-modal">
            <div class="login-header">
                <h2>Welcome Back</h2>
                <p>Sign in to access your dashboard</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-submit">Sign In</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="userModal" class="user-modal">
        <div class="user-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="userModalTitle">Add New User</h3>
                <button class="close-btn" onclick="hideUserModal()">&times;</button>
            </div>
            <form id="userForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="userName">Full Name</label>
                        <input type="text" id="userName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email Address</label>
                        <input type="email" id="userEmail" name="email" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userPassword">Password</label>
                        <input type="password" id="userPassword" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="userRole">Role</label>
                        <select id="userRole" name="role" required>
                            <option value="">Select Role</option>
                            <option value="admin">Admin</option>
                            <option value="analyst">Analyst</option>
                            <option value="viewer">Viewer</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Location</label>
                    <div class="location-container">
                        <div class="form-group">
                            <label for="userCountry">Country</label>
                            <select id="userCountry" name="country" class="location-select" onchange="updateCities('userCountry', 'userCity')">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userCity">City/Town</label>
                            <select id="userCity" name="city" class="location-select" disabled>
                                <option value="">Select City</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Permissions</label>
                    <div class="checkbox-group" id="permissionsGroup">
                        <div class="checkbox-item">
                            <input type="checkbox" id="perm_read" name="permissions" value="read">
                            <label for="perm_read">Read</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="perm_create" name="permissions" value="create">
                            <label for="perm_create">Create</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="perm_update" name="permissions" value="update">
                            <label for="perm_update">Update</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="perm_delete" name="permissions" value="delete">
                            <label for="perm_delete">Delete</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="perm_admin" name="permissions" value="admin">
                            <label for="perm_admin">Admin</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="userActive" name="is_active" checked>
                        Active User
                    </label>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i>
                        Save User
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideUserModal()" style="flex: 1;">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Sale Modal -->
    <div id="saleModal" class="user-modal">
        <div class="user-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="saleModalTitle">Add New Sale</h3>
                <button class="close-btn" onclick="hideSaleModal()">&times;</button>
            </div>
            <form id="saleForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="saleProduct">Product</label>
                        <select id="saleProduct" name="product_id" required>
                            <option value="">Select Product</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="saleQuantity">Quantity</label>
                        <input type="number" id="saleQuantity" name="quantity" min="1" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="saleUnitPrice">Unit Price</label>
                        <input type="number" id="saleUnitPrice" name="unit_price" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="saleDate">Sale Date</label>
                        <input type="date" id="saleDate" name="sale_date" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="saleCustomer">Customer Name</label>
                        <input type="text" id="saleCustomer" name="customer_name" required>
                    </div>
                    <div class="form-group">
                        <label for="saleSalesperson">Salesperson</label>
                        <input type="text" id="saleSalesperson" name="salesperson" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Location</label>
                    <div class="location-container">
                        <div class="form-group">
                            <label for="saleCountry">Country</label>
                            <select id="saleCountry" name="country" class="location-select" onchange="updateCities('saleCountry', 'saleCity')">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="saleCity">City/Town</label>
                            <select id="saleCity" name="city" class="location-select" disabled>
                                <option value="">Select City</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i>
                        Save Sale
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideSaleModal()" style="flex: 1;">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let salesData = [];
        let productsData = [];
        let usersData = [];
        let kpiData = null;
        let editingUserId = null;
        const API_BASE = 'http://localhost:8000';

        // Comprehensive location data
        const countriesData = {
            'United States': {
                cities: ['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose', 'Austin', 'Jacksonville', 'Fort Worth', 'Columbus', 'Charlotte', 'San Francisco', 'Indianapolis', 'Seattle', 'Denver', 'Washington', 'Boston', 'El Paso', 'Nashville', 'Detroit', 'Oklahoma City', 'Portland', 'Las Vegas', 'Memphis', 'Louisville', 'Baltimore', 'Milwaukee', 'Albuquerque', 'Tucson', 'Fresno', 'Sacramento', 'Mesa', 'Kansas City', 'Atlanta', 'Long Beach', 'Colorado Springs', 'Raleigh', 'Miami', 'Virginia Beach', 'Omaha', 'Oakland', 'Minneapolis', 'Tulsa', 'Arlington', 'Tampa', 'New Orleans']
            },
            'United Kingdom': {
                cities: ['London', 'Birmingham', 'Manchester', 'Glasgow', 'Liverpool', 'Leeds', 'Sheffield', 'Edinburgh', 'Bristol', 'Leicester', 'Coventry', 'Cardiff', 'Belfast', 'Nottingham', 'Hull', 'Newcastle', 'Stoke-on-Trent', 'Southampton', 'Derby', 'Portsmouth', 'Brighton', 'Plymouth', 'Northampton', 'Reading', 'Luton', 'Wolverhampton', 'Bolton', 'Bournemouth', 'Norwich', 'Swindon', 'Swansea', 'Southend-on-Sea', 'Middlesbrough', 'Peterborough', 'Huddersfield', 'York', 'Ipswich', 'Blackpool', 'West Bromwich', 'Colchester', 'Crawley', 'Stockport', 'Worcester', 'Harrow', 'Bath', 'Maidstone', 'Eastbourne', 'Grimsby', 'Halifax', 'Basingstoke']
            },
            'Canada': {
                cities: ['Toronto', 'Montreal', 'Vancouver', 'Calgary', 'Edmonton', 'Ottawa', 'Winnipeg', 'Quebec City', 'Hamilton', 'Kitchener', 'London', 'Victoria', 'Halifax', 'Oshawa', 'Windsor', 'Saskatoon', 'Regina', 'Sherbrooke', 'Kelowna', 'Barrie', 'Abbotsford', 'Sudbury', 'Kingston', 'Saguenay', 'Trois-Rivières', 'Guelph', 'Cambridge', 'Whitby', 'Saint John', 'Coquitlam', 'Saanich', 'Laval', 'Terrebonne', 'Markham', 'Burnaby', 'Richmond', 'Richmond Hill', 'Vaughan', 'Burlington', 'Brampton', 'Surrey', 'Mississauga', 'Ajax', 'Pickering', 'Oshawa', 'Whitby', 'Clarington', 'Scugog', 'Brock']
            },
            'Australia': {
                cities: ['Sydney', 'Melbourne', 'Brisbane', 'Perth', 'Adelaide', 'Gold Coast', 'Newcastle', 'Canberra', 'Sunshine Coast', 'Wollongong', 'Hobart', 'Geelong', 'Townsville', 'Cairns', 'Darwin', 'Toowoomba', 'Ballarat', 'Bendigo', 'Albury', 'Launceston', 'Mackay', 'Rockhampton', 'Bunbury', 'Coffs Harbour', 'Wagga Wagga', 'Hervey Bay', 'Port Macquarie', 'Mildura', 'Tamworth', 'Traralgon', 'Shepparton', 'Dubbo', 'Gladstone', 'Warrnambool', 'Lismore', 'Kalgoorlie', 'Bathurst', 'Warrnambool', 'Geraldton', 'Bundaberg', 'Albany', 'Devonport', 'Mount Gambier', 'Whyalla', 'Broken Hill', 'Port Augusta', 'Karratha', 'Geraldton', 'Bunbury']
            },
            'Germany': {
                cities: ['Berlin', 'Hamburg', 'Munich', 'Cologne', 'Frankfurt', 'Stuttgart', 'Düsseldorf', 'Dortmund', 'Essen', 'Leipzig', 'Bremen', 'Dresden', 'Hannover', 'Nuremberg', 'Duisburg', 'Bochum', 'Wuppertal', 'Bielefeld', 'Bonn', 'Münster', 'Karlsruhe', 'Mannheim', 'Augsburg', 'Wiesbaden', 'Gelsenkirchen', 'Mönchengladbach', 'Braunschweig', 'Chemnitz', 'Kiel', 'Aachen', 'Halle', 'Magdeburg', 'Freiburg', 'Krefeld', 'Lübeck', 'Oberhausen', 'Erfurt', 'Mainz', 'Rostock', 'Kassel', 'Hagen', 'Hamm', 'Saarbrücken', 'Mülheim', 'Potsdam', 'Ludwigshafen', 'Oldenburg', 'Leverkusen', 'Osnabrück', 'Solingen']
            },
            'France': {
                cities: ['Paris', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Strasbourg', 'Montpellier', 'Bordeaux', 'Lille', 'Rennes', 'Reims', 'Le Havre', 'Saint-Étienne', 'Toulon', 'Grenoble', 'Dijon', 'Angers', 'Nîmes', 'Villeurbanne', 'Saint-Denis', 'Le Mans', 'Aix-en-Provence', 'Clermont-Ferrand', 'Brest', 'Tours', 'Amiens', 'Limoges', 'Annecy', 'Perpignan', 'Boulogne-Billancourt', 'Orléans', 'Mulhouse', 'Rouen', 'Caen', 'Nancy', 'Saint-Denis', 'Argenteuil', 'Montreuil', 'Roubaix', 'Dunkerque', 'Nîmes', 'Avignon', 'Créteil', 'Poitiers', 'Fort-de-France', 'Colombes', 'Vitry-sur-Seine', 'Aulnay-sous-Bois', 'Asnières-sur-Seine']
            },
            'Japan': {
                cities: ['Tokyo', 'Yokohama', 'Osaka', 'Nagoya', 'Sapporo', 'Fukuoka', 'Kobe', 'Kyoto', 'Kawasaki', 'Saitama', 'Hiroshima', 'Sendai', 'Kitakyushu', 'Chiba', 'Sakai', 'Niigata', 'Hamamatsu', 'Kumamoto', 'Sagamihara', 'Shizuoka', 'Okayama', 'Kagoshima', 'Funabashi', 'Amagasaki', 'Matsuyama', 'Hachioji', 'Kurashiki', 'Ichikawa', 'Oita', 'Fukuyama', 'Nagasaki', 'Kanazawa', 'Toyonaka', 'Toyohashi', 'Toyota', 'Takamatsu', 'Hirakata', 'Asahikawa', 'Matsudo', 'Utsunomiya', 'Nishinomiya', 'Iwaki', 'Kochi', 'Koriyama', 'Kakogawa', 'Takasaki', 'Shimonoseki', 'Hakodate', 'Yamagata', 'Tsukuba']
            },
            'China': {
                cities: ['Beijing', 'Shanghai', 'Guangzhou', 'Shenzhen', 'Tianjin', 'Wuhan', 'Dongguan', 'Foshan', 'Chengdu', 'Nanjing', 'Hangzhou', 'Shenyang', 'Qingdao', 'Dalian', 'Ningbo', 'Xiamen', 'Suzhou', 'Jinan', 'Zhengzhou', 'Changsha', 'Kunming', 'Harbin', 'Fuzhou', 'Shijiazhuang', 'Wuxi', 'Hefei', 'Nanchang', 'Taiyuan', 'Shantou', 'Nanchong', 'Zibo', 'Lanzhou', 'Xuzhou', 'Yantai', 'Zhanjiang', 'Huizhou', 'Liuzhou', 'Baotou', 'Linyi', 'Nanyang', 'Handan', 'Weifang', 'Jiangmen', 'Yancheng', 'Zhongshan', 'Zhuhai', 'Jiaxing', 'Taizhou', 'Xiangyang', 'Jinhua']
            },
            'India': {
                cities: ['Mumbai', 'Delhi', 'Bangalore', 'Hyderabad', 'Ahmedabad', 'Chennai', 'Kolkata', 'Pune', 'Jaipur', 'Surat', 'Lucknow', 'Kanpur', 'Nagpur', 'Indore', 'Thane', 'Bhopal', 'Visakhapatnam', 'Pimpri-Chinchwad', 'Patna', 'Vadodara', 'Ghaziabad', 'Ludhiana', 'Agra', 'Nashik', 'Faridabad', 'Meerut', 'Rajkot', 'Kalyan-Dombivali', 'Vasai-Virar', 'Varanasi', 'Srinagar', 'Aurangabad', 'Navi Mumbai', 'Solapur', 'Vijayawada', 'Kolhapur', 'Amravati', 'Noida', 'Ranchi', 'Howrah', 'Coimbatore', 'Raipur', 'Jabalpur', 'Gwalior', 'Chandigarh', 'Tiruchirappalli', 'Mysore', 'Bhubaneswar', 'Kochi', 'Bhavnagar']
            },
            'Brazil': {
                cities: ['São Paulo', 'Rio de Janeiro', 'Brasília', 'Salvador', 'Fortaleza', 'Belo Horizonte', 'Manaus', 'Curitiba', 'Recife', 'Goiânia', 'Belém', 'Porto Alegre', 'Guarulhos', 'Campinas', 'São Luís', 'São Gonçalo', 'Maceió', 'Duque de Caxias', 'Natal', 'Teresina', 'Campo Grande', 'Nova Iguaçu', 'São Bernardo do Campo', 'João Pessoa', 'Santo André', 'Osasco', 'Jaboatão dos Guararapes', 'São José dos Campos', 'Ribeirão Preto', 'Uberlândia', 'Sorocaba', 'Contagem', 'Aracaju', 'Feira de Santana', 'Cuiabá', 'Joinville', 'Aparecida de Goiânia', 'Londrina', 'Ananindeua', 'Serra', 'Niterói', 'Caxias do Sul', 'Campos dos Goytacazes', 'Vila Velha', 'Florianópolis', 'Macapá', 'Diadema', 'São João de Meriti', 'Mauá']
            },
            'South Africa': {
                cities: ['Johannesburg', 'Cape Town', 'Durban', 'Pretoria', 'Port Elizabeth', 'Bloemfontein', 'East London', 'Pietermaritzburg', 'Nelspruit', 'Kimberley', 'Polokwane', 'Rustenburg', 'Welkom', 'Klerksdorp', 'Potchefstroom', 'Vereeniging', 'Sasolburg', 'Germiston', 'Benoni', 'Boksburg', 'Kempton Park', 'Alberton', 'Roodepoort', 'Randburg', 'Sandton', 'Centurion', 'Midrand', 'Edenvale', 'Krugersdorp', 'Carletonville', 'Westonaria', 'Vanderbijlpark', 'Vereeniging', 'Sasolburg', 'Germiston', 'Benoni', 'Boksburg', 'Kempton Park', 'Alberton', 'Roodepoort', 'Randburg', 'Sandton', 'Centurion', 'Midrand', 'Edenvale', 'Krugersdorp', 'Carletonville', 'Westonaria', 'Vanderbijlpark']
            },
            'Nigeria': {
                cities: ['Lagos', 'Kano', 'Ibadan', 'Benin City', 'Port Harcourt', 'Jos', 'Ilorin', 'Abuja', 'Kaduna', 'Maiduguri', 'Zaria', 'Aba', 'Jos', 'Ilesa', 'Oyo', 'Ikerre', 'Akure', 'Katsina', 'Onitsha', 'Abeokuta', 'Sokoto', 'Mushin', 'Maiduguri', 'Ado-Ekiti', 'Ikare', 'Ogbomoso', 'Shagamu', 'Awka', 'Gombe', 'Ikorodu', 'Uyo', 'Nnewi', 'Iseyin', 'Keffi', 'Ikot-Ekpene', 'Shaki', 'Gusau', 'Igboho', 'Effon-Alaiye', 'Kumo', 'Shomolu', 'Oka-Akoko', 'Ikire', 'Sapele', 'Deba Habe', 'Minna', 'Warri', 'Bida', 'Ife', 'Sapele']
            },
            'Kenya': {
                cities: ['Nairobi', 'Mombasa', 'Kisumu', 'Nakuru', 'Eldoret', 'Thika', 'Malindi', 'Kitale', 'Garissa', 'Kakamega', 'Kisii', 'Nyeri', 'Meru', 'Machakos', 'Nyahururu', 'Kericho', 'Embu', 'Narok', 'Kitui', 'Homa Bay', 'Wajir', 'Busia', 'Isiolo', 'Lamu', 'Marsabit', 'Mandera', 'Voi', 'Kilifi', 'Kwale', 'Taita-Taveta', 'Tana River', 'Lamu', 'Marsabit', 'Mandera', 'Voi', 'Kilifi', 'Kwale', 'Taita-Taveta', 'Tana River', 'Lamu', 'Marsabit', 'Mandera', 'Voi', 'Kilifi', 'Kwale', 'Taita-Taveta', 'Tana River', 'Lamu', 'Marsabit', 'Mandera']
            }
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            if (authToken) {
                loadDashboardData();
            }
            initializeLocationSelectors();
        });

        // Location functionality
        function initializeLocationSelectors() {
            // Populate country selectors
            const countrySelectors = document.querySelectorAll('select[id$="Country"]');
            countrySelectors.forEach(selector => {
                populateCountries(selector);
            });
        }

        function populateCountries(selectElement) {
            const countries = Object.keys(countriesData);
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                selectElement.appendChild(option);
            });
        }

        function updateCities(countrySelectId, citySelectId) {
            const countrySelect = document.getElementById(countrySelectId);
            const citySelect = document.getElementById(citySelectId);
            
            if (!countrySelect || !citySelect) return;
            
            const selectedCountry = countrySelect.value;
            citySelect.innerHTML = '<option value="">Select City</option>';
            
            if (selectedCountry && countriesData[selectedCountry]) {
                citySelect.disabled = false;
                countriesData[selectedCountry].cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            } else {
                citySelect.disabled = true;
            }
        }

        // Authentication functions
        function checkAuthStatus() {
            if (authToken) {
                // User is authenticated - show dashboard content
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('userSection').style.display = 'flex';
                document.getElementById('loginRequired').classList.add('hidden');
                document.getElementById('dashboardContainer').classList.add('authenticated');
                loadUserInfo();
            } else {
                // User is not authenticated - hide dashboard content
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('userSection').style.display = 'none';
                document.getElementById('loginRequired').classList.remove('hidden');
                document.getElementById('dashboardContainer').classList.remove('authenticated');
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    localStorage.setItem('authToken', authToken);
                    hideLoginModal();
                    checkAuthStatus();
                    loadDashboardData();
                } else {
                    alert('Login failed. Please check your credentials.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        });

        function logout() {
            authToken = null;
            localStorage.removeItem('authToken');
            checkAuthStatus();
            // Clear any sensitive data
            salesData = [];
            productsData = [];
            usersData = [];
            kpiData = null;
            // Don't reload - just hide content
        }

        async function loadUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/api/auth/me`, {
                    headers: getAuthHeaders()
                });
                if (response.ok) {
                    currentUser = await response.json();
                    document.getElementById('userName').textContent = currentUser.name;
                    document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        function getAuthHeaders() {
            return {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            };
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load section-specific data
            if (sectionId === 'analytics') {
                loadAnalyticsData();
            } else if (sectionId === 'sales') {
                loadSalesData();
            } else if (sectionId === 'products') {
                loadProductsData();
            }
        }

        // Data loading functions
        async function loadDashboardData() {
            try {
                // Load KPI data
                const kpiResponse = await fetch(`${API_BASE}/api/analytics/kpi`, {
                    headers: getAuthHeaders()
                });
                if (kpiResponse.ok) {
                    kpiData = await kpiResponse.json();
                    updateKPICards();
                }
                
                // Load sales data for charts
                const salesResponse = await fetch(`${API_BASE}/api/sales/`, {
                    headers: getAuthHeaders()
                });
                if (salesResponse.ok) {
                    salesData = await salesResponse.json();
                    createDashboardCharts();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function updateKPICards() {
            if (kpiData) {
                document.getElementById('totalRevenue').textContent = formatCurrency(kpiData.total_revenue);
                document.getElementById('totalSales').textContent = kpiData.total_sales;
                document.getElementById('netProfit').textContent = formatCurrency(kpiData.total_revenue * 0.2); // Estimated
                document.getElementById('totalProducts').textContent = kpiData.total_products;
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        // Chart creation functions
        function createDashboardCharts() {
            createRevenueChart();
            createRegionChart();
        }

        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createRegionChart() {
            const ctx = document.getElementById('regionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['North', 'South', 'East', 'West'],
                    datasets: [{
                        data: [30, 25, 25, 20],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Advanced Analytics Charts
        async function loadAnalyticsData() {
            try {
                const salesResponse = await fetch(`${API_BASE}/api/sales/`, {
                    headers: getAuthHeaders()
                });
                if (salesResponse.ok) {
                    salesData = await salesResponse.json();
                    createAdvancedCharts();
                }
            } catch (error) {
                console.error('Error loading analytics data:', error);
            }
        }

        function createAdvancedCharts() {
            createProfitExpensesChart();
            createGrossProfitChart();
            createCostRevenueChart();
            createProfitMarginChart();
            createScatterChart();
            createHistogramChart();
        }

        function createProfitExpensesChart() {
            const ctx = document.getElementById('profitExpensesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Net Profit',
                        data: [15000, 18000, 22000, 25000],
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Expenses',
                        data: [12000, 14000, 16000, 18000],
                        backgroundColor: '#ef4444'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createGrossProfitChart() {
            const ctx = document.getElementById('grossProfitChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Gross Profit',
                        data: [25000, 30000, 28000, 35000, 32000, 40000],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Cost',
                        data: [18000, 22000, 20000, 25000, 23000, 28000],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createCostRevenueChart() {
            const ctx = document.getElementById('costRevenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Product A', 'Product B', 'Product C', 'Product D', 'Product E'],
                    datasets: [{
                        label: 'Revenue',
                        data: [85, 92, 78, 88, 95],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)'
                    }, {
                        label: 'Cost',
                        data: [60, 70, 55, 65, 75],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createProfitMarginChart() {
            const ctx = document.getElementById('profitMarginChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Profit Margin %',
                        data: [25, 28, 24, 30, 27, 32],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 40
                        }
                    }
                }
            });
        }

        function createScatterChart() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Sales vs Profit',
                        data: [
                            {x: 1000, y: 250},
                            {x: 1500, y: 375},
                            {x: 2000, y: 500},
                            {x: 2500, y: 625},
                            {x: 3000, y: 750},
                            {x: 3500, y: 875},
                            {x: 4000, y: 1000}
                        ],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Sales Volume'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Profit ($)'
                            }
                        }
                    }
                }
            });
        }

        function createHistogramChart() {
            const ctx = document.getElementById('histogramChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0-5K', '5K-10K', '10K-15K', '15K-20K', '20K-25K', '25K+'],
                    datasets: [{
                        label: 'Revenue Distribution',
                        data: [5, 12, 18, 15, 8, 3],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Section-specific data loading
        async function loadSalesData() {
            try {
                const response = await fetch(`${API_BASE}/api/sales/`, {
                    headers: getAuthHeaders()
                });
                if (response.ok) {
                    salesData = await response.json();
                    displaySales();
                } else {
                    console.error('Failed to load sales');
                }
            } catch (error) {
                console.error('Error loading sales:', error);
            }
        }

        function displaySales() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            salesData.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(sale.sale_date).toLocaleDateString()}</td>
                    <td>${sale.product?.name || 'N/A'}</td>
                    <td>${sale.customer_name}</td>
                    <td>${sale.region}</td>
                    <td>${sale.salesperson}</td>
                    <td>${formatCurrency(sale.total_amount)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-secondary" onclick="editSale(${sale.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" onclick="deleteSale(${sale.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddSaleModal() {
            document.getElementById('saleModalTitle').textContent = 'Add New Sale';
            document.getElementById('saleForm').reset();
            populateProducts();
            populateCountries(document.getElementById('saleCountry'));
            document.getElementById('saleModal').classList.add('active');
        }

        function hideSaleModal() {
            document.getElementById('saleModal').classList.remove('active');
        }

        async function populateProducts() {
            try {
                const response = await fetch(`${API_BASE}/api/products/`, {
                    headers: getAuthHeaders()
                });
                if (response.ok) {
                    productsData = await response.json();
                    const productSelect = document.getElementById('saleProduct');
                    productSelect.innerHTML = '<option value="">Select Product</option>';
                    productsData.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = product.name;
                        productSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function loadProductsData() {
            // Implementation for products data loading
            console.log('Loading products data...');
        }

        // User Management Functions
        async function loadUsersData() {
            try {
                const response = await fetch(`${API_BASE}/api/users/`, {
                    headers: getAuthHeaders()
                });
                if (response.ok) {
                    usersData = await response.json();
                    displayUsers();
                } else {
                    console.error('Failed to load users');
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            usersData.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span class="user-role ${user.role}">${user.role}</span></td>
                    <td><span class="user-status ${user.is_active ? 'active' : 'inactive'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-secondary" onclick="editUser(${user.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn ${user.is_active ? 'btn-danger' : 'btn-success'}" onclick="toggleUserStatus(${user.id})">
                                <i class="fas fa-${user.is_active ? 'ban' : 'check'}"></i>
                            </button>
                            <button class="action-btn btn-danger" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUserModal() {
            editingUserId = null;
            document.getElementById('userModalTitle').textContent = 'Add New User';
            document.getElementById('userForm').reset();
            document.getElementById('userModal').classList.add('active');
        }

        function hideUserModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        function editUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                editingUserId = userId;
                document.getElementById('userModalTitle').textContent = 'Edit User';
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role;
                document.getElementById('userActive').checked = user.is_active;
                document.getElementById('userPassword').required = false;
                
                // Set permissions
                user.permissions.forEach(perm => {
                    const checkbox = document.querySelector(`input[value="${perm}"]`);
                    if (checkbox) checkbox.checked = true;
                });
                
                document.getElementById('userModal').classList.add('active');
            }
        }

        async function toggleUserStatus(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                try {
                    const response = await fetch(`${API_BASE}/api/users/${userId}`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify({ is_active: !user.is_active })
                    });
                    
                    if (response.ok) {
                        user.is_active = !user.is_active;
                        displayUsers();
                    } else {
                        alert('Failed to update user status');
                    }
                } catch (error) {
                    console.error('Error updating user status:', error);
                    alert('Error updating user status');
                }
            }
        }

        async function deleteUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user && confirm(`Are you sure you want to delete user "${user.name}"?`)) {
                try {
                    const response = await fetch(`${API_BASE}/api/users/${userId}`, {
                        method: 'DELETE',
                        headers: getAuthHeaders()
                    });
                    
                    if (response.ok) {
                        usersData = usersData.filter(u => u.id !== userId);
                        displayUsers();
                    } else {
                        alert('Failed to delete user');
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user');
                }
            }
        }

        // User form submission
        document.getElementById('userForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const userData = {
                name: formData.get('name'),
                email: formData.get('email'),
                role: formData.get('role'),
                is_active: formData.get('is_active') === 'on',
                permissions: Array.from(document.querySelectorAll('input[name="permissions"]:checked')).map(cb => cb.value)
            };
            
            // Add password for new users
            if (!editingUserId) {
                userData.password = formData.get('password');
            }
            
            try {
                let response;
                if (editingUserId) {
                    response = await fetch(`${API_BASE}/api/users/${editingUserId}`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify(userData)
                    });
                } else {
                    response = await fetch(`${API_BASE}/api/users/`, {
                        method: 'POST',
                        headers: getAuthHeaders(),
                        body: JSON.stringify(userData)
                    });
                }
                
                if (response.ok) {
                    hideUserModal();
                    loadUsersData();
                } else {
                    const error = await response.json();
                    alert(`Failed to save user: ${error.detail || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error saving user:', error);
                alert('Error saving user');
            }
        });

        // Enhanced Currency Calculations
        function calculateGrossProfit(revenue, cost) {
            return revenue - cost;
        }

        function calculateNetProfit(grossProfit, expenses) {
            return grossProfit - expenses;
        }

        function calculateProfitMargin(revenue, profit) {
            return revenue > 0 ? (profit / revenue) * 100 : 0;
        }

        function formatCurrency(amount, currency = 'USD') {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function updateKPICards() {
            if (kpiData) {
                // Enhanced calculations with proper currency formatting
                const totalRevenue = kpiData.total_revenue || 0;
                const totalCost = totalRevenue * 0.7; // Estimated cost
                const grossProfit = calculateGrossProfit(totalRevenue, totalCost);
                const expenses = totalRevenue * 0.1; // Estimated expenses
                const netProfit = calculateNetProfit(grossProfit, expenses);
                
                document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('totalSales').textContent = kpiData.total_sales;
                document.getElementById('netProfit').textContent = formatCurrency(netProfit);
                document.getElementById('totalProducts').textContent = kpiData.total_products;
                
                // Update change indicators
                document.getElementById('revenueChange').textContent = `+${kpiData.revenue_growth || 0}%`;
                document.getElementById('salesChange').textContent = '+12%';
                document.getElementById('profitChange').textContent = `+${Math.round((netProfit / totalRevenue) * 100)}%`;
            }
        }

        // Update navigation to include users section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load section-specific data
            if (sectionId === 'analytics') {
                loadAnalyticsData();
            } else if (sectionId === 'sales') {
                loadSalesData();
            } else if (sectionId === 'products') {
                loadProductsData();
            } else if (sectionId === 'users') {
                loadUsersData();
            }
        }
    </script>
</body>
</html>
